# F.E.A.R. Key Exchange Utility

Консольная утилита для безопасного обмена ключами шифрования с использованием криптографии Curve25519 (libsodium). Программа использует тот же алгоритм, что и GUI приложение проекта F.E.A.R.

## Особенности

- **Безопасность**: Использует libsodium с Curve25519 для обмена ключами
- **Совместимость**: Полностью совместима с GUI версией программы
- **Кросс-платформенность**: Работает на Linux, Windows и macOS
- **Статическая линковка**: Можно собрать полностью автономный исполняемый файл
- **Удобный интерфейс**: Интерактивное меню с цветовым оформлением
- **Экспорт/Импорт**: Сохранение и загрузка ключей из файлов

## Функции

1. **Генерация пары ключей** - Создание публичного и приватного ключей
2. **Шифрование сообщений** - Зашифровать текст для отправки собеседнику
3. **Расшифровка сообщений** - Расшифровать полученное зашифрованное сообщение
4. **Экспорт ключей** - Сохранить ключи в файл
5. **Импорт ключей** - Загрузить ключи из файла

## Сборка

### Требования

- CMake >= 3.10
- C compiler (gcc, clang, MSVC)
- libsodium

### Установка libsodium

**Debian/Ubuntu:**
```bash
sudo apt-get install libsodium-dev
```

**RHEL/CentOS/Fedora:**
```bash
sudo yum install libsodium-devel
# или
sudo dnf install libsodium-devel
```

**macOS:**
```bash
brew install libsodium
```

**Windows:**

Для Windows проект использует библиотеку из папки `lib/libsodium-win64`.

Если библиотека отсутствует:
1. Скачайте libsodium с https://download.libsodium.org/libsodium/releases/
2. Распакуйте в `lib/libsodium-win64/`
3. Убедитесь в наличии структуры:
   ```
   lib/libsodium-win64/
   ├── include/
   │   └── sodium.h
   ├── lib/
   │   └── libsodium.lib
   └── bin/
       └── libsodium.dll
   ```

Альтернативно (MSYS2/MinGW):
```bash
pacman -S mingw-w64-x86_64-libsodium
```

### Компиляция

**Статическая сборка (рекомендуется):**
```bash
mkdir build
cd build
cmake ../key-exchange -DSTATIC_BUILD=ON
cmake --build . -j4
```

**Динамическая сборка:**
```bash
mkdir build
cd build
cmake ../key-exchange -DSTATIC_BUILD=OFF
cmake --build . -j4
```

После сборки исполняемый файл будет находиться в `build/key-exchange`.

### Полная сборка проекта

Вы также можете собрать key-exchange вместе со всем проектом:
```bash
./build.sh
# или на Windows
build.bat
```

**Примечание для Windows:**
- Убедитесь, что `lib/libsodium-win64` содержит библиотеку libsodium
- При сборке DLL файл будет автоматически скопирован в папку с исполняемым файлом
- Исполняемый файл будет в `build/bin/key-exchange.exe`

## Использование

### Запуск программы
```bash
./key-exchange
```

### Пошаговая инструкция

#### 1. Генерация ключей

Оба собеседника должны сначала сгенерировать свои пары ключей:

```
Выберите пункт меню [1] Generate new key pair
```

Программа сгенерирует и покажет:
- **PUBLIC KEY** - отправьте этот ключ собеседнику
- **SECRET KEY** - храните в секрете, никому не показывайте!

#### 2. Обмен публичными ключами

Отправьте ваш PUBLIC KEY собеседнику через любой канал связи (Telegram, email, и т.д.).
Получите PUBLIC KEY от собеседника.

#### 3. Шифрование сообщения

```
Выберите пункт меню [2] Encrypt message
Введите публичный ключ получателя (hex)
Введите сообщение для шифрования
```

Программа выдаст зашифрованное сообщение в hex-формате. Отправьте его собеседнику.

#### 4. Расшифровка сообщения

```
Выберите пункт меню [3] Decrypt message
Введите публичный ключ отправителя (hex)
Введите зашифрованное сообщение (hex)
```

Программа расшифрует и покажет исходное сообщение.

#### 5. Сохранение ключей (опционально)

Для удобства можно сохранить ключи в файл:
```
Выберите пункт меню [4] Export keys to file
Введите имя файла (например, my_keys.txt)
```

Для загрузки ключей:
```
Выберите пункт меню [5] Import keys from file
Введите имя файла с ключами
```

## Пример использования

### Сценарий: Алиса отправляет секретное сообщение Бобу

**Алиса:**
1. Запускает программу, генерирует пару ключей
2. Отправляет свой PUBLIC KEY Бобу
3. Получает PUBLIC KEY от Боба
4. Выбирает "Encrypt message"
5. Вводит PUBLIC KEY Боба
6. Вводит сообщение: "Встречаемся в 15:00"
7. Получает зашифрованное сообщение (hex)
8. Отправляет зашифрованное сообщение Бобу

**Боб:**
1. Запускает программу, генерирует пару ключей
2. Отправляет свой PUBLIC KEY Алисе
3. Получает PUBLIC KEY от Алисы
4. Получает зашифрованное сообщение от Алисы
5. Выбирает "Decrypt message"
6. Вводит PUBLIC KEY Алисы
7. Вводит зашифрованное сообщение
8. Читает расшифрованное сообщение: "Встречаемся в 15:00"

## Совместимость с GUI

Эта консольная утилита полностью совместима с GUI приложением F.E.A.R.:
- Используется один и тот же алгоритм (Curve25519, crypto_box)
- Ключи имеют одинаковый формат (32 байта в hex)
- Зашифрованные сообщения взаимно читаемы

Вы можете:
- Сгенерировать ключи в GUI, экспортировать и импортировать в консольную версию
- Зашифровать сообщение в консоли, расшифровать в GUI и наоборот
- Использовать одни и те же ключи в обеих версиях

## Безопасность

### Важные рекомендации:

- **НИКОГДА** не передавайте ваш SECRET KEY никому
- Храните SECRET KEY в безопасном месте
- Используйте надежные каналы для обмена PUBLIC KEY
- Проверяйте подлинность PUBLIC KEY собеседника (например, через другой канал связи)
- Регулярно генерируйте новые пары ключей
- Не храните ключи в незашифрованном виде на общедоступных ресурсах

### Криптографические детали:

- **Алгоритм**: Curve25519 (эллиптическая криптография)
- **Библиотека**: libsodium
- **Размер ключа**: 256 бит (32 байта)
- **Шифрование**: crypto_box_easy (XSalsa20 + Poly1305)
- **Аутентификация**: MAC (Message Authentication Code)
- **Nonce**: Случайный, генерируется для каждого сообщения

## Устранение неполадок

### Ошибка: "libsodium not found"
Установите libsodium-dev или libsodium-devel для вашей системы.

### Ошибка: "Invalid public key format"
Убедитесь, что вы правильно скопировали публичный ключ (64 hex-символа).

### Ошибка: "Decryption failed"
Возможные причины:
- Неправильный публичный ключ отправителя
- Поврежденное зашифрованное сообщение
- Используются несовместимые версии программы

### Проблемы с отображением символов на Windows
Программа автоматически использует ASCII-совместимые символы для Windows. Если вы хотите использовать красивые UTF-8 символы:
1. Откройте `key-exchange/src/key-exchange.c`
2. Измените определения в блоке `#ifdef _WIN32` на Linux-версию символов
3. Перекомпилируйте программу
4. Убедитесь, что используете современный терминал (Windows Terminal, а не cmd.exe)

### Цвета не отображаются на Windows
Программа автоматически включает поддержку ANSI цветов на Windows 10 и выше. Если цвета не работают:
- Используйте Windows Terminal вместо cmd.exe
- Обновите Windows до последней версии
- Или отключите цвета, закомментировав строки с `COLOR_*` в коде

### Статическая линковка не работает на Linux
Убедитесь, что установлен пакет `libsodium-dev` и попробуйте:
```bash
cmake ../key-exchange -DSTATIC_BUILD=ON
```

Если проблема сохраняется, соберите с динамической линковкой:
```bash
cmake ../key-exchange -DSTATIC_BUILD=OFF
```

## Лицензия

Copyright (c) 2025 F.E.A.R. Project

## Автор

Evgeny Shchuchkin (shchuchkin-pkims@yandex.ru)

## История версий

### Version 2.0.0 (2025-10-16)
- Полностью переписан с использованием libsodium
- Добавлен удобный интерактивный интерфейс
- Поддержка экспорта/импорта ключей
- Статическая линковка
- Совместимость с GUI версией

### Version 0.1.0 (2025-08-22)
- Первая версия с Diffie-Hellman алгоритмом
