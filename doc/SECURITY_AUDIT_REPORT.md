  üìä –†–ï–ó–Æ–ú–ï –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

  –í–∞—à –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã (AES-256-GCM, Curve25519) —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É
  libsodium, –Ω–æ –∏–º–µ–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

  ---
  üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

  –£–°–¢–†–ê–ù–ï–ù–ê <s>1. Plaintext Secret Key Export (key-exchange.c:364-372)

  fprintf(file, "SECRET_KEY=%s\n", secret_hex);  // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ!
  –£–≥—Ä–æ–∑–∞: –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
  - –§–∞–π–ª –º–æ–∂–Ω–æ —É–∫—Ä–∞—Å—Ç—å –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ –ø–µ—Ä–µ–ø–∏—Å–∫–∏
  - –¢–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π "Keep this file secure!"
  - –ö–∞–∫ –≤–∑–ª–æ–º–∞—Ç—å: –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ

  –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  // –®–∏—Ñ—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏ –ø–∞—Ä–æ–ª–µ–º —á–µ—Ä–µ–∑ crypto_pwhash (Argon2id)
  crypto_pwhash(derived_key, KEY_LEN, password, pwd_len, salt,
                crypto_pwhash_OPSLIMIT_INTERACTIVE,
                crypto_pwhash_MEMLIMIT_INTERACTIVE,
                crypto_pwhash_ALG_ARGON2ID13);
  // –ó–∞—Ç–µ–º —à–∏—Ñ—Ä–æ–≤–∞—Ç—å secret_key —Å –ø–æ–º–æ—â—å—é derived_key —á–µ—Ä–µ–∑ AES-256-GCM</s>

  –£–°–¢–†–ê–ù–ï–ù–ê 2. <s>–ö–ª—é—á –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (audio_call.c)

  ./audio_call call 192.168.1.10 50000 a1b2c3d4e5f6...  # –ö–ª—é—á –≤–∏–¥–µ–Ω –≤ ps aux!
  –£–≥—Ä–æ–∑–∞: –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–µ–Ω –ª—é–±–æ–º—É –ª–æ–∫–∞–ª—å–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  - ps aux | grep audio_call –ø–æ–∫–∞–∂–µ—Ç –∫–ª—é—á
  - /proc/[pid]/cmdline —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á
  - –ö–∞–∫ –≤–∑–ª–æ–º–∞—Ç—å: –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ, –≤—ã–ø–æ–ª–Ω–∏—Ç—å ps

  –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  // –ß–∏—Ç–∞—Ç—å –∫–ª—é—á –∏–∑ stdin, –∞ –Ω–µ –∏–∑ argv
  fprintf(stderr, "Enter encryption key (hex): ");
  if (fgets(hexkey, sizeof(hexkey), stdin) == NULL) exit(1);
  // –û—á–∏—Å—Ç–∏—Ç—å argv –ø–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è
  memset(argv[3], 0, strlen(argv[3]));</s>

  3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç replay-–∞—Ç–∞–∫

  –£–≥—Ä–æ–∑–∞: –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å –∏ –ø–µ—Ä–µ—Å–ª–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  - Nonce —Å–ª—É—á–∞–π–Ω—ã–µ, –Ω–æ –Ω–µ –º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–µ
  - Sequence numbers –≤ –∞—É–¥–∏–æ –ù–ï –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ
  - –ö–∞–∫ –≤–∑–ª–æ–º–∞—Ç—å:
    a. –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    b. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–µ—Ä–≤–µ—Ä—É
    c. –°–µ—Ä–≤–µ—Ä —Ä–∞—Å—à–∏—Ñ—Ä—É–µ—Ç –∏ –ø—Ä–∏–º–µ—Ç –∫–∞–∫ –Ω–æ–≤–æ–µ

  –ö–æ–¥ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (client.c:335-378):
  // –ü—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–∞–ª–∏–¥–Ω—ã–º AEAD —Ç–µ–≥–æ–º
  // –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ timestamp –∏–ª–∏ sequence number

  –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  // –î–æ–±–∞–≤–∏—Ç—å timestamp –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ AEAD
  uint32_t timestamp = (uint32_t)time(NULL);
  memcpy(ad + ad_len, &timestamp, sizeof(timestamp));
  ad_len += sizeof(timestamp);

  // –ü—Ä–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É
  uint32_t msg_time = *(uint32_t*)(ad + old_ad_len);
  uint32_t now = (uint32_t)time(NULL);
  if (abs(now - msg_time) > 30) {  // ¬±30 —Å–µ–∫—É–Ω–¥ –¥–æ–ø—É—Å–∫
      fprintf(stderr, "Replay attack detected\n");
      return -1;
  }

  4. CRC-32 –≤–º–µ—Å—Ç–æ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–≥–æ —Ö–µ—à–∞ (client.c:57-66)

  uint32_t crc32(const uint8_t *data, size_t len) {
      // CRC –ù–ï –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π!
  –£–≥—Ä–æ–∑–∞: –§–∞–π–ª—ã –º–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å, –æ–±–Ω–æ–≤–∏–≤ CRC
  - CRC-32 –ª–µ–≥–∫–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å –¥–ª—è –ª—é–±—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  - –ö–∞–∫ –≤–∑–ª–æ–º–∞—Ç—å:
    a. –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —Ñ–∞–π–ª
    b. –ò–∑–º–µ–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
    c. –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å CRC-32 (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
    d. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª

  –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  // –ó–∞–º–µ–Ω–∏—Ç—å CRC-32 –Ω–∞ HMAC-SHA256
  crypto_auth_hmacsha256(file_mac, file_data, file_size, room_key);
  // –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å file_mac –≤–º–µ—Å—Ç–æ crc
  // –ü—Ä–∏ –ø—Ä–∏–µ–º–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
  if (crypto_auth_hmacsha256_verify(received_mac, file_data, file_size, room_key) != 0) {
      fprintf(stderr, "File integrity check failed!\n");
      return -1;
  }

  ---
  üü† –í–´–°–û–ö–ò–ô –†–ò–°–ö (—Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è)

  5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Perfect Forward Secrecy

  –£–≥—Ä–æ–∑–∞: –ï—Å–ª–∏ –∫–ª—é—á –∫–æ–º–Ω–∞—Ç—ã —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω, –í–°–Ø –∏—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è
  - –û–¥–∏–Ω —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª—é—á –Ω–∞ –≤—Å—é —Å–µ—Å—Å–∏—é
  - –ö–∞–∫ –≤–∑–ª–æ–º–∞—Ç—å: –ü–æ–ª—É—á–∏—Ç—å room key ‚Üí —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

  –°–ª–æ–∂–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞):
  // –í–∞—Ä–∏–∞–Ω—Ç 1: Rotation –∫–ª—é—á–µ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  uint32_t hour = time(NULL) / 3600;
  uint8_t session_key[32];
  crypto_kdf_derive_from_key(session_key, 32, hour, "FEARKEY1", room_key);

  // –í–∞—Ä–∏–∞–Ω—Ç 2: Per-message key derivation
  crypto_kdf_derive_from_key(msg_key, 32, msg_counter, "FEARMSG1", room_key);

  6. –ù–µ–ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏

  –£–≥—Ä–æ–∑–∞: –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
  - Cold boot –∞—Ç–∞–∫–∏
  - –î–∞–º–ø—ã –ø–∞–º—è—Ç–∏
  - –ù–∞–π–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏:
    - client.c:335 - decrypted message –Ω–µ –æ–±–Ω—É–ª—è–µ—Ç—Å—è
    - client.c:446 - plain buffer –Ω–µ –æ—á–∏—â–∞–µ—Ç—Å—è
    - Audio PCM –±—É—Ñ–µ—Ä—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—á–∏—â–∞—é—Ç—Å—è

  –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  // –ü–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
  sodium_memzero(decrypted, message_len);
  free(decrypted);

  // –î–ª—è —Ñ–∞–π–ª–æ–≤:
  sodium_memzero(file_data, file_size);
  free(file_data);

  7. –ù–µ—Ç –≤–∑–∞–∏–º–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

  –£–≥—Ä–æ–∑–∞: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä/–∫–ª–∏–µ–Ω—Ç - —ç—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç–æ—Ç, –∑–∞ –∫–æ–≥–æ —Å–µ–±—è –≤—ã–¥–∞–µ—Ç
  - –ö–∞–∫ –≤–∑–ª–æ–º–∞—Ç—å: Man-in-the-middle –∞—Ç–∞–∫–∞
    a. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    b. –ü—Ä–∏—Ç–≤–æ—Ä—è–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
    c. –ü—Ä–∏—Ç–≤–æ—Ä—è–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–æ–º –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
    d. –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –∏ —á–∏—Ç–∞–µ—Ç –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è

  –°–ª–æ–∂–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  // –î–æ–±–∞–≤–∏—Ç—å —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å–∏ Ed25519
  crypto_sign_keypair(server_pk, server_sk);
  // –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å:
  crypto_sign_detached(signature, &sig_len, message, msg_len, server_sk);
  // –ü—Ä–∏ –ø—Ä–∏–µ–º–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
  crypto_sign_verify_detached(signature, message, msg_len, peer_pk);

  8. Sequence numbers –≤ –∞—É–¥–∏–æ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è (audio_call.c:271-317)

  // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è, –Ω–æ –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ
  uint64_t seq = ntohll_u64(*(uint64_t*)(enc + 1));
  // –ù–ï–¢: if (seq <= last_seq) reject();
  –£–≥—Ä–æ–∑–∞: –ê—É–¥–∏–æ —Ñ—Ä–µ–π–º—ã –º–æ–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

  –ü—Ä–æ—Å—Ç–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  static uint64_t last_seq = 0;
  if (seq <= last_seq) {
      fprintf(stderr, "Duplicate or old audio frame rejected\n");
      return -1;
  }
  last_seq = seq;

  ---
  üü° –°–†–ï–î–ù–ò–ô –†–ò–°–ö

  9. –ù–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫

  - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–æ–∑—Ä–∞—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
  - Temporal –∞—Ç–∞–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã

  10. –ù–µ—Ç TLS/SSL

  - –°—ã—Ä—ã–µ TCP/UDP —Å–æ–∫–µ—Ç—ã
  - –¢–µ—Ä—è–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è

  11. –°–ª—É–∂–µ–±–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω—É–ª–µ–≤—ã–º nonce (server.c:131-188)

  memset(nonce, 0, sizeof(nonce)); // –î–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –°–º–µ—à–∏–≤–∞–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏ —Å–ª—É–∂–µ–±–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

  ---
  ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û –ü–†–ê–í–ò–õ–¨–ù–û

  1. ‚úÖ –û—Ç–ª–∏—á–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã:
    - AES-256-GCM (NIST-approved AEAD)
    - Curve25519 (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —ç–ª–ª–∏–ø—Ç–∏—á–µ—Å–∫–∞—è –∫—Ä–∏–≤–∞—è)
    - XSalsa20-Poly1305 (–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π stream cipher)
  2. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π RNG:
    - libsodium randombytes_buf()
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç /dev/urandom (Linux) –∏ CryptGenRandom() (Windows)
  3. ‚úÖ –ö–ª—é—á–∏ –ù–ï –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–æ —Å–µ—Ç–∏:
    - Out-of-band –æ–±–º–µ–Ω –∫–ª—é—á–∞–º–∏
    - –í –ø—Ä–æ—Ç–æ–∫–æ–ª–µ —Ç–æ–ª—å–∫–æ nonce –ø—Ä–µ—Ñ–∏–∫—Å—ã
  4. ‚úÖ AEAD —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
    - Room name + sender name –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è
    - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–º–µ–Ω—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

  ---
  üìã –ü–†–ò–û–†–ò–¢–ï–ó–ò–†–û–í–ê–ù–ù–´–ô –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

  ‚ö° –ù–ï–ú–ï–î–õ–ï–ù–ù–û (1-2 –Ω–µ–¥–µ–ª–∏)

  | #   | –ü—Ä–æ–±–ª–µ–º–∞                         | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è  | –§–∞–π–ª—ã              |
  |-----|----------------------------------|-----------|--------|--------------------|
  | 1   | Replay protection                | –ù–∏–∑–∫–∞—è    | 1 –¥–µ–Ω—å | client.c, server.c |
  | 2   | –ö–ª—é—á –≤ argv                      | –ù–∏–∑–∫–∞—è    | 2 —á–∞—Å–∞ | audio_call.c       |
  | 3   | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –∫–ª—é—á–µ–π | –°—Ä–µ–¥–Ω—è—è   | 1 –¥–µ–Ω—å | key-exchange.c     |
  | 4   | CRC‚ÜíHMAC –¥–ª—è —Ñ–∞–π–ª–æ–≤              | –ù–∏–∑–∫–∞—è    | 4 —á–∞—Å–∞ | client.c           |

  üìÖ –ö–†–ê–¢–ö–û–°–†–û–ß–ù–û (1-2 –º–µ—Å—è—Ü–∞)

  | #   | –ü—Ä–æ–±–ª–µ–º–∞                  | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è    | –§–∞–π–ª—ã              |
  |-----|---------------------------|-----------|----------|--------------------|
  | 5   | Sequence validation –∞—É–¥–∏–æ | –ù–∏–∑–∫–∞—è    | 4 —á–∞—Å–∞   | audio_call.c       |
  | 6   | –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏     | –°—Ä–µ–¥–Ω—è—è   | 3 –¥–Ω—è    | –í—Å–µ .c —Ñ–∞–π–ª—ã       |
  | 7   | Timestamp validation      | –ù–∏–∑–∫–∞—è    | 1 –¥–µ–Ω—å   | client.c, server.c |
  | 8   | –í–∑–∞–∏–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è   | –í—ã—Å–æ–∫–∞—è   | 1 –Ω–µ–¥–µ–ª—è | –ù–æ–≤—ã–π –º–æ–¥—É–ª—å       |

  üìÜ –°–†–ï–î–ù–ï–°–†–û–ß–ù–û (3-6 –º–µ—Å—è—Ü–µ–≤)

  | #   | –ü—Ä–æ–±–ª–µ–º–∞                   | –°–ª–æ–∂–Ω–æ—Å—Ç—å     | –í—Ä–µ–º—è      |
  |-----|----------------------------|---------------|------------|
  | 9   | Perfect Forward Secrecy    | –í—ã—Å–æ–∫–∞—è       | 2 –Ω–µ–¥–µ–ª–∏   |
  | 10  | TLS 1.3 –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏        | –í—ã—Å–æ–∫–∞—è       | 2 –Ω–µ–¥–µ–ª–∏   |
  | 11  | DTLS –¥–ª—è –∞—É–¥–∏–æ             | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | 1 –º–µ—Å—è—Ü    |
  | 12  | –í–Ω–µ—à–Ω–∏–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ | -             | 2-4 –Ω–µ–¥–µ–ª–∏ |

  ---
  üéØ –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

  | –ê—Å–ø–µ–∫—Ç             | –°—Ç–∞—Ç—É—Å        | –†–∏—Å–∫        |
  |--------------------|---------------|-------------|
  | –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è       | ‚úÖ –û—Ç–ª–∏—á–Ω–æ     | –ù–∏–∑–∫–∏–π      |
  | –•—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π    | ‚ùå –ü–ª–æ—Ö–æ       | –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô |
  | –ó–∞—â–∏—Ç–∞ –æ—Ç replay   | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô |
  | –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤ | ‚ùå –°–ª–∞–±–∞—è      | –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô |
  | –û—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏     | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ   | –í—ã—Å–æ–∫–∏–π     |
  | Forward Secrecy    | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –í—ã—Å–æ–∫–∏–π     |
  | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è     | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ   | –í—ã—Å–æ–∫–∏–π     |

  –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: –ù–ï –ì–û–¢–û–í –ö PRODUCTION –±–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
  - ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π
  - ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∑–∞–∫—Ä—ã—Ç–æ–π —Å–µ—Ç–∏
  - ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–ø–∏—Å–∫–∏
  - ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –±–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

  –í—Ä–µ–º—è –¥–æ production-ready: ~2-3 –º–µ—Å—è—Ü–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

  ---
  üí° –ö–û–ù–ö–†–ï–¢–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò –í–ó–õ–û–ú–ê

  –°—Ü–µ–Ω–∞—Ä–∏–π 1: "–£–∫—Ä–∞–¥–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –∫–ª—é—á–µ–π"

  # –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
  cat ~/.fear/my_keys.txt
  # –í–∏–¥–∏—Ç: SECRET_KEY=3627bd5f3f93722b...
  # –†–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç –í–°–ï —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

  –°—Ü–µ–Ω–∞—Ä–∏–π 2: "Process snooping"

  # –ù–∞ —Ç–æ–π –∂–µ –º–∞—à–∏–Ω–µ –¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
  ps aux | grep audio_call
  # –í–∏–¥–∏—Ç: audio_call call ... a1b2c3d4e5f6... (–ø–æ–ª–Ω—ã–π –∫–ª—é—á!)

  –°—Ü–µ–Ω–∞—Ä–∏–π 3: "Replay –∞—Ç–∞–∫–∞"

  # –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –ø–∞–∫–µ—Ç:
  captured = recv_from_network()
  # –ß–µ—Ä–µ–∑ —á–∞—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ —Å–Ω–æ–≤–∞:
  send_to_server(captured)
  # –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

  –°—Ü–µ–Ω–∞—Ä–∏–π 4: "–ü–æ–¥–º–µ–Ω–∞ —Ñ–∞–π–ª–∞"

  # –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å —Ñ–∞–π–ª + CRC
  file_data, crc = intercept_file()
  # –ò–∑–º–µ–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
  malicious_data = inject_malware(file_data)
  # –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å CRC-32 (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
  new_crc = calculate_crc32(malicious_data)
  # –û—Ç–ø—Ä–∞–≤–∏—Ç—å
  send_file(malicious_data, new_crc)  # –£—Å–ø–µ—à–Ω–æ –ø—Ä–∏–Ω—è—Ç!

  ---
  üìö –°–°–´–õ–ö–ò –ù–ê –°–¢–ê–ù–î–ê–†–¢–´

  - NIST SP 800-38D: AES-GCM specification
  - RFC 7539: ChaCha20-Poly1305 AEAD
  - RFC 7748: Curve25519 and Curve448
  - OWASP Cryptographic Storage Cheat Sheet
  - libsodium Documentation: https://doc.libsodium.org/

  –ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –æ—Å–Ω–æ–≤—É, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª—å–Ω—ã–º
  –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º.
